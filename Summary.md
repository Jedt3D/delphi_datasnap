# โปรเจคเซิร์ฟเวอร์ Delphi DataSnap

## ภาพรวมโปรเจค

โปรเจคนี้ทำหน้าที่เป็นแอปพลิเคชันเซิร์ฟเวอร์ DataSnap โดยใช้ภาษา Delphi มันจัดเตรียมเซิร์ฟเวอร์ HTTP อย่างง่ายที่เปิดเผยเมธอดจัดการข้อความหลากหลายรูปแบบผ่าน RESTful API แอปพลิเคชันทำงานเป็นแอปพลิเคชันคอนโซล ทำให้ผู้ใช้สามารถควบคุมเซิร์ฟเวอร์ผ่านคำสั่งในบรรทัดคำสั่ง

## คอมโพเนนต์หลัก

### โปรแกรมหลัก (DelphiDS.dpr)

ไฟล์โปรแกรมหลักที่เริ่มต้นและเรียกใช้เซิร์ฟเวอร์ DataSnap มันจัดเตรียมอินเตอร์เฟซคอนโซลเพื่อ:
- เริ่มและหยุดเซิร์ฟเวอร์
- เปลี่ยนพอร์ตของเซิร์ฟเวอร์
- แสดงสถานะของเซิร์ฟเวอร์
- จัดการคำสั่งผ่านอินเตอร์เฟซบรรทัดคำสั่ง

### โมดูลเซิร์ฟเวอร์

1. **ServerMethodsUnit1.pas**
   - ประกอบด้วยเมธอดหลักของเซิร์ฟเวอร์ที่สามารถเรียกได้จากระยะไกล
   - ทำหน้าที่เป็นเมธอดจัดการข้อความอย่างง่าย:
     - `EchoString`: ส่งคืนข้อความเข้ามาโดยไม่มีการเปลี่ยนแปลง
     - `ReverseString`: สลับลำดับข้อความที่เข้ามา
     - `ToUpperCase`: แปลงข้อความเข้ามาเป็นตัวพิมพ์ใหญ่
     - `ToLowerCase`: แปลงข้อความเข้ามาเป็นตัวพิมพ์เล็ก

2. **ServerContainerUnit1.pas**
   - จัดการคอมโพเนนต์ของเซิร์ฟเวอร์ DataSnap
   - สร้างและดูแลอินสแตนซ์ของเซิร์ฟเวอร์
   - ลงทะเบียนคลาสของเซิร์ฟเวอร์

3. **WebModuleUnit1.pas**
   - จัดการคำขอ HTTP ไปยังเซิร์ฟเวอร์
   - จัดการอินเตอร์เฟซเว็บสำหรับฟังก์ชันของเซิร์ฟเวอร์
   - ควบคุมการเข้าถึง server function invoker (จำกัดเฉพาะ localhost)
   - สร้างไฟล์พร็อกซี JavaScript สำหรับการโต้ตอบฝั่งไคลเอนต์

4. **ServerConst1.pas**
   - ประกอบด้วยค่าคงที่และข้อความทรัพยากรที่ใช้ในแอปพลิเคชัน
   - รวมศูนย์ข้อความสำหรับผู้ใช้และสตริงคำสั่ง

## คอมโพเนนต์ฝั่งไคลเอนต์

เซิร์ฟเวอร์สร้างไฟล์พร็อกซี JavaScript โดยอัตโนมัติที่ไคลเอนต์สามารถใช้เพื่อเรียกเมธอดของเซิร์ฟเวอร์:

- `js/serverfunctions.js`: ประกอบด้วยพร็อกซีสำหรับเมธอดของเซิร์ฟเวอร์
- `js/serverfunctioninvoker.js`: จัดเตรียมอินเตอร์เฟซผู้ใช้เพื่อทดสอบเมธอดของเซิร์ฟเวอร์
- `js/json2.js`: จัดการการแปลงข้อมูลเป็น JSON และจาก JSON

## วิธีการใช้งาน

1. **เริ่มเซิร์ฟเวอร์**:
   - รันโปรแกรม DelphiDS
   - พิมพ์ `start` ที่พร้อมต์เพื่อเริ่มเซิร์ฟเวอร์ (พอร์ตเริ่มต้น 8989)

2. **จัดการเซิร์ฟเวอร์**:
   - `stop`: หยุดเซิร์ฟเวอร์
   - `status`: แสดงสถานะปัจจุบันของเซิร์ฟเวอร์
   - `set port [number]`: เปลี่ยนพอร์ตของเซิร์ฟเวอร์
   - `help`: แสดงคำสั่งที่ใช้ได้
   - `exit`: ออกจากแอปพลิเคชัน

3. **เข้าถึงฟังก์ชันของเซิร์ฟเวอร์**:
   - จากเว็บเบราว์เซอร์บนเครื่องท้องถิ่น เยี่ยมชม: `http://localhost:8989/`
   - คลิกที่ลิงก์ "Server Functions" เพื่อเข้าถึงอินเตอร์เฟซเรียกฟังก์ชัน
   - ฟังก์ชันของเซิร์ฟเวอร์ยังสามารถถูกเรียกผ่านคำขอ HTTP โดยใช้รูปแบบ URL ที่เหมาะสม

## บันทึกสำหรับการพัฒนา

- เซิร์ฟเวอร์อนุญาตให้เรียกใช้ server function invoker จาก localhost (127.0.0.1 หรือ ::1) เท่านั้นเพื่อความปลอดภัย
- โปรเจคใช้คอมโพเนนต์ Indy สำหรับการสื่อสาร HTTP
- DataSnap จัดการการแปลงพารามิเตอร์และผลลัพธ์โดยอัตโนมัติ
- เมื่อแอปพลิเคชันเซิร์ฟเวอร์ถูกปรับปรุง ไฟล์พร็อกซี JavaScript จะถูกสร้างใหม่โดยอัตโนมัติ

## การขยายโปรเจค

เพื่อเพิ่มเมธอดเซิร์ฟเวอร์ใหม่:

1. เพิ่มประกาศเมธอดใหม่ใน `TServerMethods1` ที่ `ServerMethodsUnit1.pas`
2. ทำการสร้างเมธอดในส่วนการทำงาน
3. รีสตาร์ทเซิร์ฟเวอร์เพื่อทำให้เมธอดใหม่พร้อมใช้งาน

## ข้อควรพิจารณาด้านความปลอดภัย

- server function invoker สามารถเข้าถึงได้จาก localhost เท่านั้น
- พิจารณาทำการรับรองความถูกต้องสำหรับการใช้งานในระบบจริง
- ตรวจสอบการตั้งค่าควบคุมการเข้าถึงก่อนนำไปใช้งานในสภาพแวดล้อมการผลิต